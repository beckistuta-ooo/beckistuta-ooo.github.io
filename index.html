<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç°¡å–® Pomodoro è¨ˆæ™‚å™¨</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <h1>ğŸ… Pomodoro è¨ˆæ™‚å™¨</h1>
        
        <div class="session-type" id="sessionType">å·¥ä½œæ™‚é–“</div>
        
        <div class="mode-buttons">
            <button class="mode-btn active work" id="workMode" onclick="switchMode('work')">å·¥ä½œæ™‚é–“</button>
            <button class="mode-btn short-break" id="shortBreakMode" onclick="switchMode('shortBreak')">çŸ­ä¼‘æ¯</button>
            <button class="mode-btn long-break" id="longBreakMode" onclick="switchMode('longBreak')">é•·ä¼‘æ¯</button>
        </div>
        
        <div class="progress-ring">
            <svg width="200" height="200">
                <circle class="progress-ring__background" cx="100" cy="100" r="80"></circle>
                <circle class="progress-ring__circle" cx="100" cy="100" r="80" 
                        stroke-dasharray="502.65" stroke-dashoffset="502.65" id="progressCircle"></circle>
            </svg>
        </div>
        
        <div class="timer-display" id="timerDisplay">25:00</div>
        
        <div class="reminder-message" id="reminderMessage" style="display: none;">
            <span id="reminderText">â° æé†’æ™‚é–“åˆ°ï¼</span>
        </div>
        
        <div class="controls">
            <button class="start-btn" id="startBtn" onclick="startTimer()">é–‹å§‹</button>
            <button class="pause-btn" id="pauseBtn" onclick="pauseTimer()">æš«åœ</button>
            <button class="reset-btn" id="resetBtn" onclick="resetTimer()">é‡ç½®</button>
            <button class="reset-btn" id="resetStatsBtn" onclick="resetAllStats()" style="margin-left: 10px;">é‡ç½®çµ±è¨ˆ</button>
        </div>
        
        <div class="statistics">
            <div class="stat-item">
                <div class="stat-value" id="completedPomodoros">0</div>
                <div class="stat-label">å·²å®Œæˆå·¥ä½œæ•¸</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="currentCycle">0</div>
                <div class="stat-label">ç›®å‰é€±æœŸé€²åº¦</div>
            </div>
        </div>
        
        <div class="settings-wrapper">
            <button class="settings-toggle" onclick="toggleSettings()">
                âš™ï¸ è¨­å®š <span id="settingsArrow">â–¼</span>
            </button>
            
            <div class="settings" id="settingsPanel" style="display: none;">
                <div class="settings-grid">
                    <div class="setting-group">
                        <label for="workTime">å·¥ä½œæ™‚é–“ (åˆ†é˜):</label>
                        <input type="number" id="workTime" value="25" min="1" max="60" onchange="updateSettings()">
                    </div>
                    <div class="setting-group">
                        <label for="shortBreakTime">çŸ­ä¼‘æ¯ (åˆ†é˜):</label>
                        <input type="number" id="shortBreakTime" value="5" min="1" max="30" onchange="updateSettings()">
                    </div>
                    <div class="setting-group">
                        <label for="longBreakTime">é•·ä¼‘æ¯ (åˆ†é˜):</label>
                        <input type="number" id="longBreakTime" value="15" min="1" max="60" onchange="updateSettings()">
                    </div>
                    <div class="setting-group">
                        <label for="sessionsPerLongBreak">å·¥ä½œé€±æœŸæ•¸:</label>
                        <input type="number" id="sessionsPerLongBreak" value="4" min="2" max="10" onchange="updateSettings()">
                    </div>
                    <div class="setting-group">
                        <label for="reminderTime">æé†’æ™‚é–“ (åˆ†é˜):</label>
                        <input type="number" id="reminderTime" value="5" min="1" max="15" onchange="updateSettings()">
                    </div>
                </div>
                
                <div class="controls-section">
                    <div class="setting-group checkbox-group">
                        <label for="soundToggle">
                            <input type="checkbox" id="soundToggle" checked onchange="toggleSound()"> 
                            ğŸ”Š å•Ÿç”¨éŸ³æ•ˆ
                        </label>
                    </div>
                    
                    <div class="setting-group sound-setting">
                        <label for="reminderSoundSelect">æé†’éŸ³æ•ˆ:</label>
                        <div class="sound-selection">
                            <select id="reminderSoundSelect" onchange="changeReminderSound()">
                                <option value="gentle">ğŸµ æº«å’ŒéŸ³æ•ˆ</option>
                                <option value="chime">ğŸ”” éˆ´è²éŸ³æ•ˆ</option>
                                <option value="nature">ğŸŒ¿ è‡ªç„¶éŸ³æ•ˆ</option>
                                <option value="digital">ğŸ¤– æ•¸ä½éŸ³æ•ˆ</option>
                                <option value="piano">ğŸ¹ é‹¼ç´éŸ³æ•ˆ</option>
                                <option value="bell">ğŸ”• å–®éŸ³éˆ´è²</option>
                                <option value="soft">ğŸ’« è¼•æŸ”æç¤º</option>
                            </select>
                            <button class="preview-btn" onclick="previewReminderSound()">è©¦è½</button>
                        </div>
                    </div>
                    
                    <div class="setting-group sound-setting">
                        <label for="completionSoundSelect">å®ŒæˆéŸ³æ•ˆ:</label>
                        <div class="sound-selection">
                            <select id="completionSoundSelect" onchange="changeCompletionSound()">
                                <option value="gentle">ğŸµ æº«å’ŒéŸ³æ•ˆ</option>
                                <option value="chime">ğŸ”” éˆ´è²éŸ³æ•ˆ</option>
                                <option value="nature">ğŸŒ¿ è‡ªç„¶éŸ³æ•ˆ</option>
                                <option value="digital">ğŸ¤– æ•¸ä½éŸ³æ•ˆ</option>
                                <option value="piano">ğŸ¹ é‹¼ç´éŸ³æ•ˆ</option>
                                <option value="fanfare">ğŸº å‹åˆ©éŸ³æ•ˆ</option>
                                <option value="ascending">ğŸ“ˆ ä¸Šå‡éŸ³éš</option>
                            </select>
                            <button class="preview-btn" onclick="previewCompletionSound()">è©¦è½</button>
                        </div>
                    </div>
                    
                    <div class="setting-group">
                        <button class="notification-btn" onclick="requestNotificationPermission()">ğŸ”” å•Ÿç”¨é€šçŸ¥æ¬Šé™</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let timer = null;
        let isRunning = false;
        let currentMode = 'work'; // 'work', 'shortBreak', 'longBreak'
        let timeLeft = 25 * 60; // 25 minutes in seconds
        let totalTime = 25 * 60;
        
        // çµ±è¨ˆè®Šæ•¸
        let completedPomodoros = 0;
        let currentCycle = 0;
        
        // æé†’åŠŸèƒ½è®Šæ•¸
        let reminderShown = false;
        let titleFlashInterval = null;
        let originalTitle = document.title;
        
        // éŸ³æ•ˆæ§åˆ¶è®Šæ•¸
        let audioContext = null;
        let soundEnabled = true;
        let reminderSoundTheme = 'gentle';
        let completionSoundTheme = 'gentle';

        const timerDisplay = document.getElementById('timerDisplay');
        const sessionType = document.getElementById('sessionType');
        const startBtn = document.getElementById('startBtn');
        const pauseBtn = document.getElementById('pauseBtn');
        const progressCircle = document.getElementById('progressCircle');
        const workTimeInput = document.getElementById('workTime');
        const shortBreakTimeInput = document.getElementById('shortBreakTime');
        const longBreakTimeInput = document.getElementById('longBreakTime');
        const sessionsPerLongBreakInput = document.getElementById('sessionsPerLongBreak');
        const reminderTimeInput = document.getElementById('reminderTime');
        const reminderMessage = document.getElementById('reminderMessage');
        const reminderText = document.getElementById('reminderText');
        const soundToggle = document.getElementById('soundToggle');
        const reminderSoundSelect = document.getElementById('reminderSoundSelect');
        const completionSoundSelect = document.getElementById('completionSoundSelect');
        
        const workModeBtn = document.getElementById('workMode');
        const shortBreakModeBtn = document.getElementById('shortBreakMode');
        const longBreakModeBtn = document.getElementById('longBreakMode');
        
        // çµ±è¨ˆé¡¯ç¤ºå…ƒç´ 
        const completedPomodorosDisplay = document.getElementById('completedPomodoros');
        const currentCycleDisplay = document.getElementById('currentCycle');

        const circumference = 2 * Math.PI * 80; // 80 is the radius
        progressCircle.style.strokeDasharray = circumference;

        const modes = {
            work: {
                name: 'å·¥ä½œæ™‚é–“',
                color: '#e74c3c',
                getTime: () => parseInt(workTimeInput.value) * 60
            },
            shortBreak: {
                name: 'çŸ­ä¼‘æ¯',
                color: '#27ae60',
                getTime: () => parseInt(shortBreakTimeInput.value) * 60
            },
            longBreak: {
                name: 'é•·ä¼‘æ¯',
                color: '#3498db',
                getTime: () => parseInt(longBreakTimeInput.value) * 60
            }
        };

        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            return `${minutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`;
        }

        function updateDisplay() {
            timerDisplay.textContent = formatTime(timeLeft);
            
            const progress = 1 - (timeLeft / totalTime);
            const offset = circumference * progress;
            progressCircle.style.strokeDashoffset = circumference - offset;
        }

        function switchMode(mode) {
            if (isRunning) return; // ä¸å…è¨±åœ¨é‹è¡Œæ™‚åˆ‡æ›æ¨¡å¼
            
            currentMode = mode;
            
            // é‡ç½®æé†’ç‹€æ…‹
            reminderShown = false;
            clearVisualReminder();
            
            // æ›´æ–°æŒ‰éˆ•æ¨£å¼
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(mode + 'Mode').classList.add('active');
            
            // æ›´æ–° body class ä»¥å¥—ç”¨èƒŒæ™¯å’Œå…‰æšˆ
            document.body.className = '';
            if (mode === 'work') {
                document.body.classList.add('work-mode');
            } else if (mode === 'shortBreak') {
                document.body.classList.add('short-break-mode');
            } else if (mode === 'longBreak') {
                document.body.classList.add('long-break-mode');
            }
            
            // æ›´æ–°é¡¯ç¤º
            const modeConfig = modes[currentMode];
            sessionType.textContent = modeConfig.name;
            progressCircle.style.stroke = modeConfig.color;
            
            // é‡ç½®è¨ˆæ™‚å™¨åˆ°æ–°æ¨¡å¼çš„æ™‚é–“
            timeLeft = modeConfig.getTime();
            totalTime = timeLeft;
            
            updateDisplay();
        }

        function updateSettings() {
            if (!isRunning) {
                // æ›´æ–°ç•¶å‰æ¨¡å¼çš„æ™‚é–“
                const newTime = modes[currentMode].getTime();
                timeLeft = newTime;
                totalTime = newTime;
                updateDisplay();
            }
        }

        function startTimer() {
            if (!isRunning) {
                isRunning = true;
                startBtn.textContent = 'é€²è¡Œä¸­...';
                startBtn.disabled = true;
                
                // é‡ç½®æé†’ç‹€æ…‹ï¼ˆç•¶ç¹¼çºŒæˆ–é‡æ–°é–‹å§‹æ™‚ï¼‰
                reminderShown = false;
                
                timer = setInterval(() => {
                    timeLeft--;
                    updateDisplay();
                    
                    // æª¢æŸ¥æ˜¯å¦éœ€è¦é¡¯ç¤ºæé†’
                    checkReminder();
                    
                    if (timeLeft <= 0) {
                        completeSession();
                    }
                }, 1000);
            }
        }

        function pauseTimer() {
            if (isRunning) {
                isRunning = false;
                clearInterval(timer);
                startBtn.textContent = 'ç¹¼çºŒ';
                startBtn.disabled = false;
            }
        }

        function resetTimer() {
            isRunning = false;
            clearInterval(timer);
            startBtn.textContent = 'é–‹å§‹';
            startBtn.disabled = false;
            
            // é‡ç½®æé†’ç‹€æ…‹
            reminderShown = false;
            clearVisualReminder();
            
            // é‡ç½®åˆ°ç•¶å‰æ¨¡å¼çš„é è¨­æ™‚é–“
            const modeConfig = modes[currentMode];
            timeLeft = modeConfig.getTime();
            totalTime = timeLeft;
            
            updateDisplay();
        }
        
        function resetAllStats() {
            completedPomodoros = 0;
            currentCycle = 0;
            updateStatistics();
        }
        
        function updateStatistics() {
            completedPomodorosDisplay.textContent = completedPomodoros;
            currentCycleDisplay.textContent = currentCycle;
        }
        
        function checkReminder() {
            const reminderMinutes = parseInt(reminderTimeInput.value);
            const reminderTime = reminderMinutes * 60; // è½‰æ›ç‚ºç§’æ•¸
            
            // å¦‚æœå‰©é¤˜æ™‚é–“ç­‰æ–¼æé†’æ™‚é–“ï¼Œä¸”é‚„æœªé¡¯ç¤ºéæé†’
            if (timeLeft === reminderTime && !reminderShown) {
                reminderShown = true;
                
                // é¡¯ç¤ºæé†’
                const modeConfig = modes[currentMode];
                const message = `æé†’ï¼š${modeConfig.name}é‚„å‰© ${reminderMinutes} åˆ†é˜ï¼`;
                
                // Console è¨˜éŒ„
                console.log(message);
                
                // è¦–è¦ºæé†’æ•ˆæœ
                showVisualReminder(message);
                
                // æ’­æ”¾æé†’éŸ³æ•ˆ
                playReminderSound();
                
                // å¦‚æœæ”¯æ´é€šçŸ¥ï¼Œç™¼é€ç€è¦½å™¨é€šçŸ¥
                if ('Notification' in window && Notification.permission === 'granted') {
                    new Notification('Pomodoro æé†’', {
                        body: message,
                        icon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y=".9em" font-size="90">â°</text></svg>'
                    });
                }
            }
        }
        
        function showVisualReminder(message) {
            // 1. é¡¯ç¤ºæé†’æ–‡å­—
            reminderText.textContent = message;
            reminderMessage.style.display = 'block';
            
            // 2. èƒŒæ™¯é–ƒçˆ›æ•ˆæœ
            document.body.classList.add('reminder-flash');
            
            // 3. æ¨™é¡Œé–ƒçˆ›æ•ˆæœ
            let flashCount = 0;
            titleFlashInterval = setInterval(() => {
                if (flashCount % 2 === 0) {
                    document.title = 'â° æé†’ï¼';
                } else {
                    document.title = originalTitle;
                }
                flashCount++;
                
                // é•ƒ6æ¬¡å¾Œåœæ­¢é–ƒçˆ›
                if (flashCount >= 6) {
                    clearInterval(titleFlashInterval);
                    document.title = originalTitle;
                }
            }, 500);
            
            // 5ç§’å¾Œè‡ªå‹•éš±è—æé†’æ–‡å­—
            setTimeout(() => {
                reminderMessage.style.display = 'none';
                document.body.classList.remove('reminder-flash');
            }, 5000);
        }
        
        function clearVisualReminder() {
            // æ¸…é™¤æé†’è¨Šæ¯
            reminderMessage.style.display = 'none';
            document.body.classList.remove('reminder-flash');
            
            // åœæ­¢æ¨™é¡Œé–ƒçˆ
            if (titleFlashInterval) {
                clearInterval(titleFlashInterval);
                titleFlashInterval = null;
                document.title = originalTitle;
            }
        }
        
        // éŸ³æ•ˆä¸»é¡Œé…ç½®
        const soundThemes = {
            gentle: {
                name: 'æº«å’ŒéŸ³æ•ˆ',
                reminder: [523.25, 659.25], // C5, E5
                completion: [523.25, 659.25, 783.99], // C5, E5, G5
                waveType: 'sine',
                volume: 0.1
            },
            chime: {
                name: 'éˆ´è²éŸ³æ•ˆ',
                reminder: [880, 1108.73], // A5, C#6
                completion: [880, 1108.73, 1318.51], // A5, C#6, E6
                waveType: 'sine',
                volume: 0.12
            },
            nature: {
                name: 'è‡ªç„¶éŸ³æ•ˆ',
                reminder: [392, 523.25], // G4, C5
                completion: [392, 523.25, 659.25], // G4, C5, E5
                waveType: 'triangle',
                volume: 0.08
            },
            digital: {
                name: 'æ•¸ä½éŸ³æ•ˆ',
                reminder: [698.46, 830.61], // F5, G#5
                completion: [698.46, 830.61, 987.77], // F5, G#5, B5
                waveType: 'square',
                volume: 0.06
            },
            piano: {
                name: 'é‹¼ç´éŸ³æ•ˆ',
                reminder: [261.63, 329.63], // C4, E4
                completion: [261.63, 329.63, 392], // C4, E4, G4
                waveType: 'triangle',
                volume: 0.15
            },
            bell: {
                name: 'å–®éŸ³éˆ´è²',
                reminder: [800], // å–®ç´”çš„éˆ´è²
                completion: [800, 800, 800], // ä¸‰è²éˆ´éŸ¿
                waveType: 'sine',
                volume: 0.12
            },
            soft: {
                name: 'è¼•æŸ”æç¤º',
                reminder: [440, 554.37], // A4, C#5 - å¾ˆè¼•æŸ”çš„æé†’
                completion: [440, 554.37, 659.25], // A4, C#5, E5
                waveType: 'sine',
                volume: 0.06
            },
            fanfare: {
                name: 'å‹åˆ©éŸ³æ•ˆ',
                reminder: [523.25, 659.25], // C5, E5
                completion: [523.25, 659.25, 783.99, 1046.5], // C5, E5, G5, C6 - å‹åˆ©è™Ÿè§’
                waveType: 'sine',
                volume: 0.18
            },
            ascending: {
                name: 'ä¸Šå‡éŸ³éš',
                reminder: [523.25, 659.25], // C5, E5
                completion: [261.63, 329.63, 392, 523.25, 659.25], // C4â†’E4â†’G4â†’C5â†’E5 é•·éŸ³éš
                waveType: 'triangle',
                volume: 0.12
            }
        };
        
        // WebAudio éŸ³æ•ˆå‡½æ•¸
        function initAudioContext() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
        }
        
        function playTone(frequency, duration, delay = 0, waveType = 'sine', volume = 0.1) {
            if (!soundEnabled || !soundToggle.checked) return;
            
            initAudioContext();
            
            setTimeout(() => {
                const osc = audioContext.createOscillator();
                const gain = audioContext.createGain();
                osc.connect(gain);
                gain.connect(audioContext.destination);
                
                osc.frequency.value = frequency;
                osc.type = waveType;
                gain.gain.value = volume;
                gain.gain.setValueAtTime(0, audioContext.currentTime);
                gain.gain.linearRampToValueAtTime(volume, audioContext.currentTime + 0.01);
                gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
                
                osc.start();
                osc.stop(audioContext.currentTime + duration);
            }, delay);
        }
        
        function playReminderSound() {
            const theme = soundThemes[reminderSoundTheme];
            theme.reminder.forEach((freq, index) => {
                const duration = theme.reminder.length === 1 ? 0.5 : 0.3; // å–®éŸ³éˆ´è²æŒçºŒä¹…ä¸€é»
                playTone(freq, duration, index * 200, theme.waveType, theme.volume);
            });
        }
        
        function playCompletionSound() {
            const theme = soundThemes[completionSoundTheme];
            theme.completion.forEach((freq, index) => {
                let delay = index * 150;
                let duration = 0.4;
                
                // ç‰¹æ®Šè™•ç†ä¸åŒéŸ³æ•ˆçš„ç¯€å¥
                if (completionSoundTheme === 'fanfare') {
                    delay = index * 120; // å‹åˆ©éŸ³æ•ˆæ’­æ”¾å¿«ä¸€é»
                    duration = 0.5;
                } else if (completionSoundTheme === 'ascending') {
                    delay = index * 180; // ä¸Šå‡éŸ³éšæ…¢ä¸€é»ï¼Œæ›´æœ‰å±¤æ¬¡
                    duration = 0.6;
                } else if (completionSoundTheme === 'bell') {
                    delay = index * 300; // éˆ´è²é–“éš”é•·ä¸€é»
                    duration = 0.8;
                }
                
                playTone(freq, duration, delay, theme.waveType, theme.volume * 1.2);
            });
        }
        
        function toggleSound() {
            soundEnabled = soundToggle.checked;
        }
        
        function changeReminderSound() {
            reminderSoundTheme = reminderSoundSelect.value;
        }
        
        function changeCompletionSound() {
            completionSoundTheme = completionSoundSelect.value;
        }
        
        function previewReminderSound() {
            if (!soundEnabled || !soundToggle.checked) {
                alert('è«‹å…ˆå•Ÿç”¨éŸ³æ•ˆåŠŸèƒ½');
                return;
            }
            
            // æ’­æ”¾æé†’éŸ³æ•ˆ
            const theme = soundThemes[reminderSoundTheme];
            theme.reminder.forEach((freq, index) => {
                const duration = theme.reminder.length === 1 ? 0.5 : 0.3;
                playTone(freq, duration, index * 200, theme.waveType, theme.volume);
            });
        }
        
        function previewCompletionSound() {
            if (!soundEnabled || !soundToggle.checked) {
                alert('è«‹å…ˆå•Ÿç”¨éŸ³æ•ˆåŠŸèƒ½');
                return;
            }
            
            // æ’­æ”¾å®ŒæˆéŸ³æ•ˆ
            playCompletionSound();
        }
        
        function toggleSettings() {
            const panel = document.getElementById('settingsPanel');
            const arrow = document.getElementById('settingsArrow');
            
            if (panel.style.display === 'none') {
                panel.style.display = 'block';
                arrow.textContent = 'â–²';
            } else {
                panel.style.display = 'none';
                arrow.textContent = 'â–¼';
            }
        }
        
        function requestNotificationPermission() {
            if ('Notification' in window) {
                Notification.requestPermission().then(permission => {
                    if (permission === 'granted') {
                        alert('é€šçŸ¥æ¬Šé™å·²å•Ÿç”¨ï¼');
                        // æ¸¬è©¦é€šçŸ¥
                        new Notification('Pomodoro è¨ˆæ™‚å™¨', {
                            body: 'é€šçŸ¥åŠŸèƒ½å·²æˆåŠŸå•Ÿç”¨',
                            icon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y=".9em" font-size="90">ğŸ…</text></svg>'
                        });
                    } else if (permission === 'denied') {
                        alert('é€šçŸ¥æ¬Šé™è¢«æ‹’çµ•ï¼Œè«‹åœ¨ç€è¦½å™¨è¨­å®šä¸­æ‰‹å‹•å•Ÿç”¨ã€‚');
                    } else {
                        alert('é€šçŸ¥æ¬Šé™è«‹æ±‚è¢«å¿½ç•¥ã€‚');
                    }
                });
            } else {
                alert('æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æ´é€šçŸ¥åŠŸèƒ½ã€‚');
            }
        }

        function completeSession() {
            isRunning = false;
            clearInterval(timer);
            startBtn.textContent = 'é–‹å§‹';
            startBtn.disabled = false;
            
            // å¦‚æœå®Œæˆçš„æ˜¯ Work æ¨¡å¼ï¼Œæ›´æ–°çµ±è¨ˆ
            if (currentMode === 'work') {
                completedPomodoros++;
                currentCycle++;
                updateStatistics();
            }
            
            // æ’­æ”¾å®ŒæˆéŸ³æ•ˆ
            playCompletionSound();
            
            // é¡¯ç¤ºé€šçŸ¥
            if ('Notification' in window) {
                if (Notification.permission === 'granted') {
                    const modeConfig = modes[currentMode];
                    new Notification(`${modeConfig.name}çµæŸï¼`, {
                        body: currentMode === 'work' ? 'è©²ä¼‘æ¯äº†ï¼' : 'è©²å·¥ä½œäº†ï¼',
                        icon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y=".9em" font-size="90">ğŸ…</text></svg>'
                    });
                } else if (Notification.permission !== 'denied') {
                    Notification.requestPermission().then(permission => {
                        if (permission === 'granted') {
                            const modeConfig = modes[currentMode];
                            new Notification(`${modeConfig.name}çµæŸï¼`);
                        }
                    });
                }
            }
            
            // æ±ºå®šä¸‹ä¸€å€‹æ¨¡å¼
            let nextMode;
            if (currentMode === 'work') {
                // æª¢æŸ¥æ˜¯å¦è©²é€²å…¥é•·ä¼‘æ¯ï¼ˆä½¿ç”¨å¯è¨­å®šçš„é€±æœŸæ•¸ï¼‰
                const sessionsPerLongBreak = parseInt(sessionsPerLongBreakInput.value);
                if (currentCycle >= sessionsPerLongBreak) {
                    nextMode = 'longBreak';
                    currentCycle = 0; // é‡ç½®é€±æœŸ
                    updateStatistics();
                } else {
                    nextMode = 'shortBreak';
                }
            } else {
                // å¾ä»»ä½•ä¼‘æ¯æ¨¡å¼å›åˆ°å·¥ä½œæ¨¡å¼
                nextMode = 'work';
            }
            
            setTimeout(() => {
                const nextModeConfig = modes[nextMode];
                switchMode(nextMode);
                // ä¸è‡ªå‹•é–‹å§‹ä¸‹ä¸€å€‹è¨ˆæ™‚å™¨ï¼Œè®“ç”¨æˆ¶æ‰‹å‹•é–‹å§‹
                console.log(`å·²åˆ‡æ›è‡³ ${nextModeConfig.name}ï¼Œè«‹é»æ“Šé–‹å§‹æŒ‰éˆ•ç¹¼çºŒ`);
            }, 1000);
        }

        // è«‹æ±‚é€šçŸ¥æ¬Šé™
        if ('Notification' in window && Notification.permission === 'default') {
            Notification.requestPermission();
        }

        // åˆå§‹åŒ–é¡¯ç¤º
        switchMode('work');
        updateStatistics();
    </script>
</body>
</html>